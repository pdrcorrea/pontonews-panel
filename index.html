<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>PontoView ‚Ä¢ Not√≠cias</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;600;800;900&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet"/>

<style>
:root{
  --blue1:#3a78a7;
  --blue2:#0f3b5e;

  --bg:#ffffff;
  --ink:#0b1320;
  --muted:rgba(11,19,32,.55);
  --line:rgba(11,19,32,.10);

  --safe:clamp(16px,2.4vw,36px);

  /* Cabe√ßalho maior */
  --barH:clamp(76px,9vh,104px);

  /* Manchete equilibrada para TV */
  --t-title:clamp(26px,3.3vw,54px);
  --t-desc:clamp(15px,1.55vw,22px);
  --t-chip:clamp(12px,1.05vw,16px);

  --radius:clamp(18px,2.4vw,32px);
}

*{box-sizing:border-box}
html,body{height:100%}

body{
  margin:0;
  font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  background:var(--bg);
  color:var(--ink);
  overflow:hidden;
}

.screen{
  width:100vw;
  height:100vh;
  display:flex;
  flex-direction:column;
}

/* ================= CABE√áALHO ================= */
.topbar{
  height:var(--barH);
  padding:0 var(--safe);
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:20px;
  background:linear-gradient(180deg,var(--blue1),var(--blue2));
  color:#fff;
  border-bottom:1px solid rgba(255,255,255,.18);
}

.brand{
  display:flex;
  align-items:center;
  gap:14px;
  min-width:0;
}

.brandIcon{
  width:clamp(46px,5.8vh,64px);
  height:clamp(46px,5.8vh,64px);
  border-radius:14px;
  display:grid;
  place-items:center;
  background:rgba(255,255,255,.12);
  border:1px solid rgba(255,255,255,.22);
  box-shadow: inset 0 1px 0 rgba(255,255,255,.15);
  flex:0 0 auto;
}

.brandIcon span{
  font-size:clamp(22px,2.4vh,30px);
}

.brandTitle{
  font-weight:900;
  letter-spacing:.14em;
  text-transform:uppercase;
  font-size:clamp(18px,2.2vw,30px);
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

.sourceChip{
  display:flex;
  align-items:center;
  gap:10px;
  padding:10px 16px;
  border-radius:999px;
  background:rgba(255,255,255,.18);
  border:1px solid rgba(255,255,255,.22);
  max-width:50vw;
  min-width:180px;
}

.sourceDot{
  width:22px;
  height:22px;
  border-radius:999px;
  background:#fff;
  display:grid;
  place-items:center;
  overflow:hidden;
  flex:0 0 auto;
}

.sourceDot img{
  width:16px;
  height:16px;
  object-fit:contain;
  display:block;
}

.sourceText{
  font-weight:900;
  letter-spacing:.08em;
  text-transform:uppercase;
  font-size:var(--t-chip);
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

/* ================= CONTE√öDO ================= */
.stage{
  flex:1;
  padding:var(--safe);
  display:grid;
  grid-template-columns:1.1fr .9fr;
  gap:clamp(20px,3vw,48px);
  align-items:center;
  min-height:0;
}

.left{
  min-width:0;
}

.headline{
  font-size:var(--t-title);
  font-weight:900;
  line-height:1.10;
  margin:0 0 18px 0;

  /* limite de linhas p/ n√£o explodir layout */
  display:-webkit-box;
  -webkit-box-orient:vertical;
  -webkit-line-clamp:3; /* m√°x 3 linhas */
  overflow:hidden;
}

.desc{
  font-size:var(--t-desc);
  line-height:1.5;
  color:var(--muted);
  max-width:60ch;
  margin:0;

  /* limite padr√£o de linhas */
  display:-webkit-box;
  -webkit-box-orient:vertical;
  -webkit-line-clamp:6;
  overflow:hidden;
}

/* Quando o texto √© longo => prioriza manchete + imagem */
.desc.is-collapsed{
  display:none !important;
}

/* ================= IMAGEM (RSS) ================= */
.right{
  position:relative;
  border-radius:var(--radius);
  overflow:hidden;
  background:linear-gradient(180deg,var(--blue1),var(--blue2));
  min-height:clamp(240px,44vh,620px);
  box-shadow:0 22px 70px rgba(2,10,23,.16);
}

.right img{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  object-fit:cover;
  opacity:1;
}

.right::after{
  content:"";
  position:absolute;
  inset:0;
  background:linear-gradient(180deg,rgba(0,0,0,.05),rgba(0,0,0,.18));
}

.right.noimg img{display:none}
.right.noimg::after{
  background:
    radial-gradient(800px 500px at 30% 30%,rgba(255,255,255,.20),transparent 60%),
    linear-gradient(180deg,rgba(0,0,0,.05),rgba(0,0,0,.22));
}

/* ================= RODAP√â ================= */
.footer{
  padding:10px var(--safe);
  border-top:1px solid var(--line);
  display:flex;
  justify-content:flex-end;
  align-items:center;
}

.footer img{
  height:clamp(16px,2.4vh,22px);
  opacity:.55;
}

/* ================= RESPONSIVO VERTICAL ================= */
@media (orientation:portrait){
  .stage{
    grid-template-columns:1fr;
    grid-template-rows:auto 1fr;
    align-items:stretch;
  }
  .right{
    min-height:clamp(220px,36vh,520px);
  }
  .sourceChip{ max-width:60vw; }
}

/* ================= TRANSI√á√ÉO ================= */
.fade{
  transition:opacity .45s ease, transform .45s ease;
  will-change: opacity, transform;
}
.out{opacity:0;transform:translateY(10px)}
.in{opacity:1;transform:none}

@media (prefers-reduced-motion:reduce){
  .fade{transition:none}
}
</style>
</head>

<body>
<div class="screen">

<header class="topbar">
  <div class="brand">
    <div class="brandIcon"><span class="material-icons-outlined">newspaper</span></div>
    <div class="brandTitle">Not√≠cias</div>
  </div>

  <div class="sourceChip" title="Fonte da not√≠cia">
    <span class="sourceDot"><img id="favicon" alt=""></span>
    <span class="sourceText" id="sourceText">Fonte da not√≠cia</span>
  </div>
</header>

<main class="stage">
  <section class="left fade in" id="textWrap">
    <h1 class="headline" id="title">Carregando‚Ä¶</h1>
    <p class="desc" id="desc"></p>
  </section>

  <section class="right noimg fade in" id="mediaWrap">
    <img id="image" alt="">
  </section>
</main>

<footer class="footer">
  <img src="./assets/logo-pontoview.png" alt="PontoView">
</footer>

</div>

<script>
/* ================= CONFIG ================= */
const WORKER_BASE = "https://pontoview-api.pedrhc258.workers.dev/api/news";

/* Rota√ß√£o */
const ROTATE_MS = 12000;     // tempo entre not√≠cias
const TRANSITION_MS = 450;   // deve bater com CSS

/* Regras de ‚Äúpriorizar manchete + imagem‚Äù */
const DESC_MAX_CHARS = 420;       // texto √© cortado nesse limite
const DESC_LONG_THRESHOLD = 260;  // se passar disso, escondemos a descri√ß√£o
const DESC_MIN_WORDS = 12;        // se muito curto, mant√©m

/* ================= HELPERS ================= */
function host(u){ try{ return new URL(u).hostname.replace(/^www\./,""); }catch{ return ""; } }
function favicon(u){
  try{ return "https://www.google.com/s2/favicons?domain="+new URL(u).hostname+"&sz=64"; }
  catch{ return ""; }
}
function imgProxy(u){
  if(!u) return "";
  let url = String(u).trim();
  if(!url) return "";
  if(url.startsWith("//")) url = "https:" + url;
  if(!/^https?:\/\//i.test(url)) return "";
  return "https://images.weserv.nl/?url=" + encodeURIComponent(url.replace(/^https?:\/\//i,""))
    + "&w=1600&h=900&fit=cover&output=webp";
}
function cleanText(t){
  if(!t) return "";
  return String(t)
    .replace(/<[^>]*>/g,"")     // remove HTML
    .replace(/\s+/g," ")        // normaliza espa√ßos
    .replace(/üì≤|üëâ|üîó/g,"")     // remove emojis comuns de feed
    .trim();
}
function wordCount(t){
  if(!t) return 0;
  return t.trim().split(/\s+/).filter(Boolean).length;
}
function ellipsis(t, max){
  if(!t) return "";
  if(t.length <= max) return t;
  return t.slice(0, max).replace(/\s+\S*$/,"").trim() + "‚Ä¶";
}

/* ================= UI ================= */
const titleEl = document.getElementById("title");
const descEl  = document.getElementById("desc");
const imgEl   = document.getElementById("image");
const media   = document.getElementById("mediaWrap");
const text    = document.getElementById("textWrap");
const favEl   = document.getElementById("favicon");
const sourceText = document.getElementById("sourceText");

/* ================= STATE ================= */
let NEWS = [];
let idx = 0;
let timer = null;

/* ================= TRANSITION ================= */
function showOut(){ text.classList.add("out"); media.classList.add("out"); }
function showIn(){  text.classList.remove("out"); media.classList.remove("out"); }

/* ================= RENDER ================= */
function applyPriorityMode(description){
  // Se o texto for longo: esconde descri√ß√£o (prioriza manchete + imagem)
  const wc = wordCount(description);
  const isLong = (description.length >= DESC_LONG_THRESHOLD && wc >= DESC_MIN_WORDS);

  if(isLong){
    descEl.classList.add("is-collapsed");
  }else{
    descEl.classList.remove("is-collapsed");
  }
}

function render(it){
  const title = cleanText(it.title || "Not√≠cia");
  const descRaw = cleanText(it.description || it.summary || "");

  titleEl.textContent = ellipsis(title, 400); // corte defensivo p/ evitar t√≠tulos absurdos
  const desc = ellipsis(descRaw, DESC_MAX_CHARS);
  descEl.textContent = desc;

  applyPriorityMode(descRaw);

  const h = host(it.link);
  sourceText.textContent = (h || "Fonte").toUpperCase();

  const fav = favicon(it.link);
  if(fav){
    favEl.src = fav;
    favEl.parentElement.style.display = "grid";
  }else{
    favEl.parentElement.style.display = "none";
  }

  const img = imgProxy(it.image);
  if(img){
    imgEl.src = img;
    media.classList.remove("noimg");
    imgEl.onerror = () => {
      media.classList.add("noimg");
      imgEl.removeAttribute("src");
      imgEl.onerror = null;
    };
  }else{
    media.classList.add("noimg");
    imgEl.removeAttribute("src");
    imgEl.onerror = null;
  }
}

function step(){
  if(!NEWS.length) return;
  showOut();
  setTimeout(()=>{
    render(NEWS[idx++ % NEWS.length]);
    showIn();
  }, TRANSITION_MS);
}

/* ================= LOAD ================= */
async function load(){
  try{
    const res = await fetch(WORKER_BASE, { cache:"no-store" });
    const j = await res.json();
    NEWS = (j.items || []).filter(x => x && x.title);
    if(!NEWS.length) throw new Error("Sem itens");

    idx = Math.floor(Math.random() * NEWS.length);
    render(NEWS[idx++]);
    showIn();

    if(timer) clearInterval(timer);
    timer = setInterval(step, ROTATE_MS);
  }catch(e){
    console.error(e);
    titleEl.textContent = "Sem not√≠cias no momento";
    descEl.textContent = "";
    descEl.classList.add("is-collapsed");
    sourceText.textContent = "PONTO VIEW";
    favEl.parentElement.style.display = "none";
    media.classList.add("noimg");
    imgEl.removeAttribute("src");
    showIn();
    setTimeout(load, 8000);
  }
}

load();
</script>
</body>
</html>
