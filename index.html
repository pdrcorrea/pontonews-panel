<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>PontoView • Notícias</title>

<link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;600;800;900&display=swap" rel="stylesheet"/>

<style>
  :root{
    --header: linear-gradient(180deg,#2f6f9d 0%,#184c75 55%,#0f3b5e 100%);
    --bg: radial-gradient(1200px 900px at 25% 10%, rgba(87,184,231,.22), rgba(10,46,62,0) 60%),
          radial-gradient(900px 700px at 75% 80%, rgba(52,198,208,.14), rgba(6,18,24,0) 65%),
          radial-gradient(1400px 1100px at 50% 55%, #0a2232 0%, #081423 62%, #040a0f 100%);
    --card:#ffffff;
    --line:#e6edf7;
    --chip:#f3f7ff;
    --ink:#0e1b2a;

    --radius:22px;
    --shadow:0 18px 60px rgba(2,10,23,.18);
    --safe: clamp(14px, 2.2vw, 32px);

    --t-title: clamp(22px, 2.1vw, 34px);
    --t-sub:   clamp(12px, 1.05vw, 16px);
    --t-clock: clamp(42px, 4.2vw, 78px);
    --t-headline: clamp(30px, 4.4vw, 70px);
    --t-foot: clamp(11px, 0.95vw, 13px);
  }

  *{box-sizing:border-box}
  html,body{height:100%}

  body{
    margin:0;
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    background:var(--bg);
    color:var(--ink);
    overflow:hidden;
  }

  .frame{width:100vw;height:100vh;padding:var(--safe);display:flex}
  .panel{
    width:100%;height:100%;
    background:var(--card);
    border-radius:var(--radius);
    overflow:hidden;
    box-shadow:var(--shadow);
    display:flex;flex-direction:column;min-height:0;
    opacity:0;transform:translateY(10px);
    animation: panelIn 700ms cubic-bezier(.22,1,.36,1) forwards;
  }
  @keyframes panelIn{to{opacity:1;transform:none}}

  .header{
    padding: clamp(14px, 1.4vw, 22px) clamp(16px, 1.8vw, 26px);
    background:var(--header);
    color:#fff;
    display:flex;justify-content:space-between;align-items:center;gap:16px;
    border-bottom:1px solid rgba(255,255,255,.12);
    min-width:0;
  }
  .h-left{display:flex;gap:14px;align-items:center;min-width:0}
  .iconBadge{
    width:clamp(44px, 3.2vw, 62px);
    height:clamp(44px, 3.2vw, 62px);
    border-radius:16px;
    display:grid;place-items:center;
    background:rgba(255,255,255,.10);
    border:1px solid rgba(255,255,255,.22);
    box-shadow: inset 0 1px 0 rgba(255,255,255,.18);
    flex:0 0 auto;
  }
  .iconBadge .material-icons-outlined{font-size:clamp(22px, 2vw, 30px); opacity:.95}

  .title{
    font-size:var(--t-title);
    font-weight:900;
    letter-spacing:.06em;
    text-transform:uppercase;
    white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
  }

  .h-right{display:flex;flex-direction:column;align-items:flex-end}
  .clock{
    font-size:var(--t-clock);
    font-weight:900;
    line-height:1;
    font-variant-numeric: tabular-nums;
  }

  .subbar{
    background:var(--chip);
    border-bottom:1px solid var(--line);
    padding: 10px clamp(16px, 1.8vw, 26px);
    display:flex;justify-content:space-between;align-items:center;gap:12px;
  }
  .subbarLeft{
    font-size:var(--t-sub);
    font-weight:900;
    letter-spacing:.14em;
    text-transform:uppercase;
    color:#1c2c41;
    white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
  }
  .pill{
    display:inline-flex;align-items:center;gap:10px;
    padding:8px 12px;border-radius:999px;
    background:rgba(255,255,255,.78);
    border:1px solid rgba(15,23,42,.08);
    color:#0f172a;
    font-weight:900;
    font-size:clamp(12px, 1.05vw, 16px);
  }
  .dot{width:10px;height:10px;border-radius:50%;background:#22c55e}
  .dot.off{background:#ef4444}

  .hero{
    position:relative;flex:1 1 auto;min-height:0;overflow:hidden;
    background:
      radial-gradient(1200px 760px at 35% 25%, rgba(56,189,248,.18), rgba(0,0,0,0) 60%),
      radial-gradient(900px 640px at 75% 80%, rgba(34,197,94,.10), rgba(0,0,0,0) 60%),
      linear-gradient(180deg, #0b1220 0%, #0a1b2e 45%, #0b1020 100%);
  }
  .hero img{
    position:absolute;inset:0;width:100%;height:100%;
    object-fit:cover;opacity:.78;transition:opacity 220ms ease;
  }
  .hero.noimg img{opacity:0}
  .overlay{
    position:absolute;inset:0;
    background:
      linear-gradient(180deg, rgba(0,0,0,.10) 0%, rgba(0,0,0,.55) 58%, rgba(0,0,0,.78) 100%),
      radial-gradient(900px 520px at 30% 75%, rgba(0,0,0,.35), rgba(0,0,0,0) 65%);
  }
  .content{
    position:absolute;left:clamp(16px, 1.8vw, 26px);
    right:clamp(16px, 1.8vw, 26px);
    bottom:clamp(18px, 2.0vw, 26px);
    color:#fff;display:flex;flex-direction:column;gap:10px;
    max-width:min(1280px, 92vw);
    transition: opacity 280ms ease, transform 280ms ease;
  }
  .headline{
    font-size:var(--t-headline);
    font-weight:900;
    line-height:1.05;
    text-shadow:0 8px 24px rgba(0,0,0,.35);
  }

  .footer{
    height: clamp(46px, 5.4vh, 72px);
    display:flex;align-items:center;justify-content:space-between;
    padding:10px clamp(16px, 1.8vw, 26px);
    border-top:1px solid var(--line);
    gap:14px;
  }
  .footerLeft{display:flex;align-items:center;gap:10px;min-width:0;overflow:hidden}
  .siteBubble{
    width:26px;height:26px;border-radius:999px;
    background:rgba(255,255,255,.90);
    border:1px solid rgba(15,23,42,.10);
    display:grid;place-items:center;overflow:hidden;flex:0 0 auto;
  }
  .siteBubble img{width:16px;height:16px;object-fit:contain;display:block}
  .footMeta{
    font-size:var(--t-foot);
    font-weight:900;
    letter-spacing:.10em;
    text-transform:uppercase;
    color:#31445f;
    white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
  }
  .footerRight img{height:clamp(16px, 2.4vh, 22px);opacity:.8}
</style>
</head>

<body>
<div class="frame">
  <section class="panel">
    <div class="header">
      <div class="h-left">
        <div class="iconBadge"><span class="material-icons-outlined">newspaper</span></div>
        <div class="title">NOTÍCIAS</div>
      </div>
      <div class="h-right"><div class="clock" id="clock">--:--</div></div>
    </div>

    <div class="subbar">
      <div class="subbarLeft" id="subLeft">MANCHETE ATUAL</div>
      <div class="pill"><span class="dot" id="dot"></span><span id="statusText">Online</span></div>
    </div>

    <div class="hero noimg" id="hero">
      <img id="image" alt="Imagem da notícia" />
      <div class="overlay"></div>
      <div class="content">
        <div class="headline" id="title">Carregando…</div>
      </div>
    </div>

    <div class="footer">
      <div class="footerLeft">
        <span class="siteBubble"><img id="favicon" alt="" /></span>
        <div class="footMeta" id="footMeta">FONTE • —</div>
      </div>
      <div class="footerRight">
        <img src="./assets/logo-pontoview.png" alt="PontoView"/>
      </div>
    </div>
  </section>
</div>

<script>
/* ===== CONFIG (compatível com pv-news-v6) ===== */
const WORKER_BASE = "https://pontoview-api.pedrhc258.workers.dev/api/news";

const SAFE = 1;            // 1 = sala de espera (leve)
const LIMIT = 20;          // igual ao worker default
const TTL_HOURS = 6;
const MAX_AGE_HOURS = 72;
const MAX_PER_SOURCE = 5;

const UI_ROTATE_MS = 15000; // coloque 0 se não quiser rodar

/* ===== CLOCK ===== */
const clock = document.getElementById("clock");
function tickClock(){
  clock.textContent = new Date().toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"});
}
tickClock(); setInterval(tickClock, 1000);

/* ===== ONLINE ===== */
const statusText = document.getElementById("statusText");
const dot = document.getElementById("dot");
function updateStatus(){
  if(navigator.onLine){ statusText.textContent="Online"; dot.classList.remove("off"); }
  else{ statusText.textContent="Offline"; dot.classList.add("off"); }
}
updateStatus();
addEventListener("online", updateStatus);
addEventListener("offline", updateStatus);

/* ===== HELPERS ===== */
function host(u){ try{return new URL(u).hostname.replace(/^www\./,"");}catch{return""} }
function favicon(u){
  try{ return "https://www.google.com/s2/favicons?domain=" + new URL(u).hostname + "&sz=64"; }
  catch{ return ""; }
}
function imgProxy(u){
  if(!u) return "";
  let url = String(u).trim();
  if(!url) return "";
  if(url.startsWith("//")) url = "https:" + url;
  if(!/^https?:\/\//i.test(url)) return "";
  return "https://images.weserv.nl/?url=" + encodeURIComponent(url.replace(/^https?:\/\//i,""))
    + "&w=1600&h=900&fit=cover&output=webp";
}
function fmtPub(d){
  if(!d) return "—";
  const t = new Date(d);
  if(Number.isNaN(t.getTime())) return "—";
  return t.toLocaleString("pt-BR");
}

function buildApiUrl(){
  const params = new URLSearchParams({
    safe: String(SAFE),
    limit: String(LIMIT),
    ttlHours: String(TTL_HOURS),
    maxAgeHours: String(MAX_AGE_HOURS),
    maxPerSource: String(MAX_PER_SOURCE),
    seed: "1",
    _: String(Date.now()) // cache-buster
  });
  return `${WORKER_BASE}?${params.toString()}`;
}

/* ===== UI refs ===== */
const hero = document.getElementById("hero");
const titleEl = document.getElementById("title");
const imgEl = document.getElementById("image");
const favEl = document.getElementById("favicon");
const metaEl = document.getElementById("footMeta");
const subLeft = document.getElementById("subLeft");

/* ===== DATA ===== */
let NEWS = [];
let idx = 0;
let timer = null;

function renderOne(it){
  titleEl.textContent = it.title || "Notícia";
  subLeft.textContent = "MANCHETE ATUAL";

  const prox = imgProxy(it.image);
  if(prox){
    imgEl.src = prox;
    hero.classList.remove("noimg");
    imgEl.onerror = () => {
      hero.classList.add("noimg");
      imgEl.removeAttribute("src");
      imgEl.onerror = null;
    };
  }else{
    hero.classList.add("noimg");
    imgEl.removeAttribute("src");
    imgEl.onerror = null;
  }

  const fav = favicon(it.link);
  if(fav){ favEl.src = fav; favEl.style.display="block"; }
  else { favEl.style.display="none"; }

  metaEl.textContent = `${host(it.link).toUpperCase() || "PONTOVIEW"} • ${fmtPub(it.pubDate)}`;
}

function renderCurrent(){
  if(!NEWS.length) return;
  const it = NEWS[idx % NEWS.length];
  idx++;
  renderOne(it);
}

async function refresh(){
  try{
    const url = buildApiUrl();
    const res = await fetch(url, { cache:"no-store" });
    const j = await res.json();

    if(j?.warmingUp){
      // mostra placeholder, tenta de novo em alguns segundos
      NEWS = (j.items || []);
      idx = 0;
      renderCurrent();
      setTimeout(refresh, 7000);
      return;
    }

    NEWS = (j.items || []).filter(x => x && x.title);
    if(!NEWS.length) throw new Error("Sem items");

    idx = Math.floor(Math.random() * NEWS.length);
    renderCurrent();

    if(timer) clearInterval(timer);
    if(UI_ROTATE_MS && UI_ROTATE_MS >= 3000){
      timer = setInterval(renderCurrent, UI_ROTATE_MS);
    }
  }catch(e){
    console.error(e);
    titleEl.textContent = "Sem notícias no momento";
    metaEl.textContent = "PONTOVIEW • —";
    favEl.style.display = "none";
    hero.classList.add("noimg");
    imgEl.removeAttribute("src");
    setTimeout(refresh, 8000);
  }
}

refresh();
</script>

</body>
</html>
